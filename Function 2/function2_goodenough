#include <stdio.h>
#include <string.h>
#include <ctype.h>

typedef struct {
    char name[50];
    char ID[20];  // IDs stored as strings

    char sub1[50];
    float sub1grd;

    char sub2[50];
    float sub2grd;

    char sub3[50];
    float sub3grd;

} input;

// Pre-loaded student data
input students[] = {
    {"Shaun",    "1820252068", "Art", 85, "Business", 88, "Engineering", 91},
    {"Nathan",   "1820252049", "Art", 79, "Business", 82, "Engineering", 87},
    {"Roderick", "1820252057", "Art", 92, "Business", 90, "Engineering", 95},
    {"Fandy",    "1820254567", "Art", 75, "Business", 70, "Engineering", 80},
    {"Lance",    "1820252058", "Art", 88, "Business", 84, "Engineering", 89}
};

int total_students = 5;

// Case-insensitive string compare
int stricmp_custom(const char *a, const char *b) {
    while (*a && *b) {
        if (tolower(*a) != tolower(*b)) return 1;
        a++; b++;
    }
    return (*a || *b) ? 1 : 0;
}

// --- Result Query Function ---
void result_query() {
    char name_search[50];
    char id_search[20];
    char subject_search[50];

    printf("\n==================== RESULT QUERY ====================\n");

    getchar(); // clear leftover newline
    printf("Enter Student Name (or press ENTER to skip): ");
    fgets(name_search, sizeof(name_search), stdin);
    name_search[strcspn(name_search, "\n")] = 0;

    printf("Enter Student ID (or press ENTER to skip): ");
    fgets(id_search, sizeof(id_search), stdin);
    id_search[strcspn(id_search, "\n")] = 0;

    printf("Enter Subject Name (Art/Business/Engineering) or press ENTER to skip: ");
    fgets(subject_search, sizeof(subject_search), stdin);
    subject_search[strcspn(subject_search, "\n")] = 0;

    printf("\n------------------ Search Results ------------------\n");

    int found = 0;
    for (int i = 0; i < total_students; i++) {
        int match_name = (strlen(name_search) == 0 || stricmp_custom(students[i].name, name_search) == 0);
        int match_ID   = (strlen(id_search) == 0 || stricmp_custom(students[i].ID, id_search) == 0);
        int match_sub  = (strlen(subject_search) == 0 ||
                          stricmp_custom(students[i].sub1, subject_search) == 0 ||
                          stricmp_custom(students[i].sub2, subject_search) == 0 ||
                          stricmp_custom(students[i].sub3, subject_search) == 0);

        // Only show if the record matches the search criteria
        if ((match_name && match_ID && match_sub) || 
            (match_name && match_sub && strlen(id_search) == 0) || 
            (match_ID && match_sub && strlen(name_search) == 0)) {

            printf("\nName: %s\n", students[i].name);
            printf("ID: %s\n", students[i].ID);
            printf("Grades:\n");

            // Show all subjects if no specific subject is entered
            if (strlen(subject_search) == 0) {
                printf("  %s: %.2f\n", students[i].sub1, students[i].sub1grd);
                printf("  %s: %.2f\n", students[i].sub2, students[i].sub2grd);
                printf("  %s: %.2f\n", students[i].sub3, students[i].sub3grd);
            } else {
                // Show only the requested subject
                if (stricmp_custom(students[i].sub1, subject_search) == 0)
                    printf("  %s: %.2f\n", students[i].sub1, students[i].sub1grd);
                if (stricmp_custom(students[i].sub2, subject_search) == 0)
                    printf("  %s: %.2f\n", students[i].sub2, students[i].sub2grd);
                if (stricmp_custom(students[i].sub3, subject_search) == 0)
                    printf("  %s: %.2f\n", students[i].sub3, students[i].sub3grd);
            }
            found = 1;
        }
    }

    if (!found) {
        printf("\nNo matching student record found.\n");
    }

    printf("----------------------------------------------------\n");
    printf("Press ENTER to return to the main menu...");
    getchar(); // pause
}

// --- Placeholder function for input ---
void input_info() {
    printf("\nInput info placeholder.\n\n");
    printf("Press ENTER to return to the main menu...");
    getchar();
}

// --- Main Program ---
int main() {
    int operator;

    do {
        printf("\n\t\t\t\t********************************************************\n");
        printf("\t\t\t\t*    Welcome to the Student Grade Management System    *\n");
        printf("\t\t\t\t*    Please enter your options:                        *\n");
        printf("\t\t\t\t*    1. Input Basic Study Student Information          *\n");
        printf("\t\t\t\t*    2. Result Query                                   *\n");
        printf("\t\t\t\t*    3. Result Statistics                              *\n");
        printf("\t\t\t\t*    4. Failing Statistics                             *\n");
        printf("\t\t\t\t*    5. Browsing of Results                            *\n");
        printf("\t\t\t\t*    0. Exit                                           *\n");
        printf("\t\t\t\t********************************************************\n");
        printf("\t\t\t\tPlease input a number (0-5): ");

        scanf("%d",&operator);

        switch(operator){
            case 1:
                input_info();
                break;
            case 2:
                result_query();
                break;
            case 3:
                printf("\nResult Statistics placeholder.\n");
                printf("Press ENTER to return to the main menu...");
                getchar(); getchar(); // pause
                break;
            case 4:
                printf("\nFailing Statistics placeholder.\n");
                printf("Press ENTER to return to the main menu...");
                getchar(); getchar(); // pause
                break;
            case 5:
                printf("\nBrowsing of Results placeholder.\n");
                printf("Press ENTER to return to the main menu...");
                getchar(); getchar(); // pause
                break;
            case 0:
                printf("\nExiting program...\n");
                break;
            default:
                printf("\nInvalid input. Please enter a number from 0 to 5.\n");
        }

    } while(operator != 0);

    return 0;
}
